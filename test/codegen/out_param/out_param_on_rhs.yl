// RUN: compiler %s -llvm-dump 2>&1 | filecheck %s
// RUN: compiler %s -o out_param_on_rhs && ./out_param_on_rhs | grep -Plzx '1\n2\n2\n1\n'

// CHECK: define void @swap(ptr %x, ptr %y)
fn swap(x: &number, y: &number) {
  let tmp = x;
  // CHECK: %tmp = alloca double, align 8
  // CHECK-NEXT: %0 = load double, ptr %x, align 8
  // CHECK-NEXT: store double %0, ptr %tmp, align 8

  x = y;
  // CHECK-NEXT: %1 = load double, ptr %y, align 8
  // CHECK-NEXT: store double %1, ptr %x, align 8

  y = tmp;
  // CHECK-NEXT: %2 = load double, ptr %tmp, align 8
  // CHECK-NEXT: store double %2, ptr %y, align 8

  // CHECK-NEXT: ret void
}

fn main() {
  mut x = 1;
  mut y = 2;
  // CHECK: %x = alloca double, align 8
  // CHECK-NEXT: %y = alloca double, align 8
  // CHECK-NEXT: store double 1.000000e+00, ptr %x, align 8
  // CHECK-NEXT: store double 2.000000e+00, ptr %y, align 8

  println(x);
  println(y);

  swap(&x, &y);
  // CHECK: call void @swap(ptr %x, ptr %y)

  println(x);
  println(y);
}
