// RUN: compiler %s -llvm-dump 2>&1 | filecheck %s
// RUN: compiler %s -o generic_struct_function_member && ./generic_struct_function_member | grep -Plzx '10\n'

// CHECK: %struct.SGnE = type { ptr }

struct S<T> {
  x: (T)-> T
}

fn boxNum(x: number): number {
  return x;
}

fn main(): void {
  let s = S{x: boxNum};
  println(s.x(10));
}
// CHECK: define void @__builtin_main() {
// CHECK-NEXT: entry:
// CHECK-NEXT:   %s = alloca %struct.SGnE, align 8
// CHECK-NEXT:   %S.tmp = alloca %struct.SGnE, align 8
// CHECK-NEXT:   %0 = getelementptr inbounds nuw %struct.SGnE, ptr %S.tmp, i32 0, i32 0
// CHECK-NEXT:   store ptr @boxNum, ptr %0, align 8
// CHECK-NEXT:   call void @llvm.memcpy.p0.p0.i64(ptr align 8 %s, ptr align 8 %S.tmp, i64 8, i1 false)

// CHECK-NEXT:   %1 = getelementptr inbounds nuw %struct.SGnE, ptr %s, i32 0, i32 0
// CHECK-NEXT:   %2 = load ptr, ptr %1, align 8
// CHECK-NEXT:   %3 = call double %2(double 1.000000e+01)
// CHECK-NEXT:   call void @println(double %3)
// CHECK-NEXT:   ret void
// CHECK-NEXT: }
