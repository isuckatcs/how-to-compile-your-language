// RUN: compiler %s -llvm-dump 2>&1 | filecheck %s
// RUN: compiler %s -o generic_struct_nested_complex && ./generic_struct_nested_complex | grep -Plzx '246\n'

struct A<T> {
  x: T
}

struct B<T> {
  a: A<(T) -> T>
}

fn double(n: number): number {
  return n * 2;
}

fn main(): void {
  let b = B{a: A{x: double}};

  println(b.a.x(123));
  // CHECK: %2 = getelementptr inbounds nuw { { ptr } }, ptr %b, i32 0, i32 0
  // CHECK-NEXT: %3 = getelementptr inbounds nuw { ptr }, ptr %2, i32 0, i32 0
  // CHECK-NEXT: %4 = load ptr, ptr %3, align 8
  // CHECK-NEXT: %5 = call double %4(double 1.230000e+02)
  // CHECK-NEXT: call void @println(double %5)
}
